language: ruby

cache:
  - bundler

rvm:
  - 2.6.1

script:
  - docker build . -t dshivang0/photoapp_api:latest
  - docker run -e DB_USER_PASSWORD=$DB_USER_PASSWORD -e DB_NAME=$DB_NAME -e DB_USER_NAME=$DB_USER_NAME -e DB_USER_PASSWORD_ALT=$DB_USER_PASSWORD_ALT -e DB_NAME_ALT=$DB_NAME_ALT -e DB_USER_NAME_ALT=$DB_USER_NAME_ALT -e SUPER_SECRET_AUTH_KEY=$SUPER_SECRET_AUTH_KEY -e SUPER_SECRET_USER_KEY=$SUPER_SECRET_USER_KEY -e RAILS_ENV=$RAILS_ENV dshivang0/photoapp_api:latest rails db:migrate
  - docker run -e DB_USER_PASSWORD=$DB_USER_PASSWORD -e DB_NAME=$DB_NAME -e DB_USER_NAME=$DB_USER_NAME -e DB_USER_PASSWORD_ALT=$DB_USER_PASSWORD_ALT -e DB_NAME_ALT=$DB_NAME_ALT -e DB_USER_NAME_ALT=$DB_USER_NAME_ALT -e SUPER_SECRET_AUTH_KEY=$SUPER_SECRET_AUTH_KEY -e SUPER_SECRET_USER_KEY=$SUPER_SECRET_USER_KEY -e RAILS_ENV=$RAILS_ENV dshivang0/photoapp_api:latest rspec
  
env:
  global:
  - secure: XP89nl2pTeFPtPXijv68P8QWVDB50QtbecUT+jNYVqgGDup3TuzJsm83qDOoWsUqeXGXW0vH/wY/Hi1QCFDTDngdDxMcFH4ZkuxMVhkoJrFD24EzXrkWIdGAWVb9lz4doQgPjjHLgeRg5MiPUHOe2rzzPG9WLYV428c37c5+sxszr8NAGEx7Is5G9f8H29ofFKebb+9Yi4EQaImdXIso7tguWAzC1UM5bg+wS9Lb7bf5iKTh5dTUiBuwyPeHMMoSE2m1iJNndldVVlRxSGTlapWdLjzsEue7HupyLAgiEqeXFqElXnfqW3+6B9ErRJB3DxU7LKi+jfd43LVgebO17vMZZNlw5e/G2e0EmfWP5cSEksS9irHfrD7Yp7ubI/sG4O+OLysEXasguaXnsaLBnGfTBI38pM8FkoWPdK6+T2t9jYQkTyAk6AE3QAh8bHpI3aGpDt/KoLc4lX7gkgjrsoRrKgzBr+2AWFCoOhT4WzgbAlGV3NzufwIJb7gjtFYAcjtHBs/9IA5Rq96aF4DGK318+dOm8w4MroaMBFMIg1NMLpLYOGjU7HPQio2lAwUH0Guh5nMv6B7n5qeSO0qyORjKCOdMvjzP7vYCprmgHrtUnQueGxPl2AC2LDY70cP9hny7ZyjFYZR/Z6D/4npCeNbGpzB+YG0xguV3WLmjaIg=
  - secure: x5O0PODI8a+ZdiV1IPP9RG0aTinFOK6274/KsBG+aE1/wtENFuRQIyaIocdGPFDG9jx4epjE59Dwtks/o+m3XxYoPeQ+tt+Qr2Z1N+6PKtRsq5huix11mXKLWmNWnG1DcBMhXedAt72yrgV9fc7I7nMU2yJb72bOQCAjb5nhqugw0eWKPgicbUtau4CD01zLXToDomkgizRv+ENX9I4trW9g3PSoPWH6ir1S+LV/KvhYrYLAeXkz1kRY36SBu5xslWS7o6asyQOAV/xfW8R5wrS5dHy+8CLztxzzNljPXkiaCPx3qQMQlg+cQc4GuUbaWYD8v/lyFwXriaFXVhlcal6mDohdX2p4zdaeh0JdOIAC7VN9Nc76jMJWI5VsJvr9tcCYGixb3+vVdRqaPVDWKx0SdXbf6BTQ2OE52cV+lps1PlrHTHWO9tWWfsru37VC3sHx1XsWOQBsG7AYDMInjt5QnPu5wkvd9XpPcNNwEiIVKb3ZF/1NxS8gImTUmYOgEq5zdrLeAwfhJXRiIaCNBCC8N/tB3yUmmyv0dIXSNxoQEZf58HUEaXCx3a2yLZ75i6T6D7NE+LT34aVRslhWXJUii406mQE3ta2YzA6KPxSrtnUH7nHxBz5KhMjVEprS3UrLQB+5DriYDAS6o+MptAJA+CO7lV9fTCeMobulXXs=
  
  - secure: "EW3cvPkxLb++1IApkPw2Lwf5leNudQ6yvU2LXcRH0qS8ZuR2oe2swX4yj66iQ8qOj6PqGbZPl5R4kF5DYnBG8Ogr8FOadNekcmmzCqKcLeyVAE1pXvAdAAz00cqrmUpkSGW67Tuhz7ltKVELvE7Bt23YQyF0yY94RXJ/5fZfz051p9gZlGiwKT9bl1uZJjNcWwtk9sYE/48PdSX8vh1w/StE6bD3q+V6QSOlGN0x8cT6SiU+TT3hq9VWET3z56MBkSrKwUpjXhRUjAPwHRlZpV0lVLtgeh4ny/fUHI0qDSkqPo9sV15yTdtAtu5D3++eLnDt+b7fopRfWyhl2dF8Yy5QbzRKspndiKjL6wVPoa44BSsaXvusNfG+2tPSoGRhnb1M2qX/DhnJSh/JmGVsGQRTWTrfsgM8gd+nooojguoTeUPDr57Hu+gMHvnre2zKbB57NjPp4jkaBgDb0gQVn1Eh5anpwVlMKaaqsPLQT+8tr3Yi+4Ellhx00xs34BkkEhfLVj12CUn6i59c+LO2Gi9SeYCCkpAxQMJr78jdZrmf0amJkjrmmrFPjtEqYTpijbuvqLpkrvmZYeQGmUUYHH9hKkp4jUL3o0C5lUUUPdJFWKFQUKZmjUq7BsSL7KX4cGkVbGAY+4u3IJI2mwYKJ3QHQF2WjJALj2lMtp+BN/w="
  - secure: "iSzdm/RO/yzbbQnBP50ZgGr4n5Dz7mjtpZsjsMo7S3BtJ+YEZnI3cqvab8Ne13TDrfeaXnqlI69vuqz0ONbsrjNK2+KiMJ4kMYElT1mU08eSYKUqMa1vfRKZDGCUUGAvHZ7GYuHZwqH0/3/IdZoHNqWE3nY9ItdIX5lzS8Nfau94Ord18jc474C02VvKi7AfFrsVPJQiBWlzgQyi3p3z1XmWZdkvkffoOc2PTTJ6VTpvtd4u5+rx6ybxfGBJwBFkBIQfDL40mgMYu9eg/wU53k1WM+BsFNBo7thGi3BeJgxtw/4zDZqReoie7GPCRTDOOTrW5XhBHz0cRmf7fjW3Wfn+CrbHZYlKp/J0MgM04MIypB8uATE0X6xMX5MiHnX4paedziyKj5NrCEa2kCYqMZRM8Vp1NWdCJbBGUxYF3mgLiU3ZNBzr8pyI2F3D9OJVowSCWiM0xze8v6/L1aN7FR47P0z3EIrUFdAp9bE2ezPynhtNOPJRyP9DBJjfeVfpmkX3XerWciUo5Pm3dF7RI4TW9Qx/QSp3rP+0bIruiBI7h8Wbg2KsxYaOnbpL74tzPAw2uSbBnnVtZmSR5qJ2bv09ftTCRW9J2GzwPANTyhZ8AIPbbovEnoekC6Sa8mVtMG+d/+MlZhsF4sNxi3U+WfMF+lNG5upCaSeLPEV71Ok="
  - secure: "Ha7Wut8AL3gaoRUpHApExTvSj1XVm25On8i0GJWnNYz5BtrZntN0cm0NEZyCXP7Ik5aOXk8nrvxkMlm0HPmsYIiFD8WMHekoprQM2RNgkqu1zqD3H1lozk0rtgG2+BhJxOZDANVJbor+PpeeOw8zvzNbcAOd7wKx+TjZWtORgtng7FrWZ9h29dz0H4awqrNuwW3gq2cCXQANa0bffcBaiCDovqpAZx4kPisk06cBZ/F04FW89lq+aiRM3lHSxZSp0gREijRQt7R2nvM/eRWcmbYeb0p6RT8kxYZm/B8K511D73RSG449EIUsYr4Akl8WCOC4lH+wub38Lvm4hjz3ar7T4HOwSe6SzH4wGYHrE02srNe+ECz5Jyi2vSuaAeqFVS3qO5MPSNuURdQwi7G5rPi/PcGB9P/I/yXkfib2ydu+/E1N/oYQ4JE64VkEZlT2zeXflSrgt2kuVOqofismftuE/2xXl8nrqu52xi+LYzTXmEt7SlKlMZ32ZLJBCg9J06yOKOBf3ZcJPtRT+6U7IQw3dakYY/pb2xXJMuBul3iyroJAH6M8t+XMHvBKzxgVgyI3t8KsuCgun3kW0KQne8Oi9RVqSaogYVVyRlC4cfIYjIkrRZiR7Vq1caL84lxB3tJEXSi16OHybuvW4Xo2qavwTpI4WGqDslNF11cLvuM="
  
  - secure: "IgVovhv4JadImD63iZvrut7w8J7C+/Ng2/xREPTQyCWwZFc/eK384etSP7EBsj6hPAZBNaXx490lcLFDD3CJ+hDxTeMQXvZsB5n+F7i2YzHqNX4Gq7cVFI3IlbH9On7rScooJeObH+UbpFlRRHD5jRhDocwlmHJZ4DTsXwY5Ygt4Zh9n4Cv4ST757CKpuHQHg/CG6LO/K2/E8CmO4cjv/Ft78AGrWllKKUp8sn7XndzVIivH+9YvRb2SdKS7joUFzOhUDsy2omQuA3pXOKPsFAFVWdzHUL6Sicf30M9UZ7JRBBVmsN3MkyCn1jRjUjaHemyfla7Q23MyLXdjZkUtzZBjCc83L6TEHXiV5GqtJX22JAG9uooaWDg7tHKcjm8yhYEDeovioKuA6VZCHnkdfaDnn8SMe/LeU5vtsvEud+rR+Eubn2+SJDqeXmNMHmoZPGUj9SswP8tO5dC6aDRJJsGEUdlw+8s6F9URw7trZ7siReIGWca/IT9cNVhz9ru7rePlAOFx4aaztT5XjWNrtzpgrIsAREdt2z3kysCZvrzUwuBGgoafPepdF9maQNuBw5n4PDYnHlXGyYPIGFLmaXq7ogaMdaGmKDr9j7hdcU5CAWQkFHA+fQ+1VjigpqICgQt8GbvH5C3DDW6CrZ6ZwvXSw9JDushMXmAXLp/JsDw="
  - secure: "zWJs7kjFwtJ6BwlfoQySwxYTqvw1xYX/39RDGcy/HyrSRFWeldB4yON2sAsynoK/jmyYN2k/hnhwWWapmKd2U8CYiQLzK/456858oS+BVmYPGGQ9n/m6fwMzDiWMqxakoEbcCxdKRoxrLW7dlXE60DlqmEG5IZRLP+vdTRGyA/0mEJsgaFhjT0rnUwDZ+ixzFrblGRpEM1FIINKeaQudIKYvRtT8UpiJmnQMQf3PGFozjzaGWiDwzCivcGjotCJLOFLn5KCS5/Mq9RL117XSTmHDGnoPMZ90/EZvqM3gINLVMFjK8QDYh+CBA9uEA6v5jihhQznFxdmG1WV32KDipjJhaJJDxQ1STkzcZvzPjN/D/62C2dUCPOcENEpREZKrLypbROjaMMPBq5GSm8bdpARlKPO7KNvCpveciH/u/PdIL8alfPwmjY5DFY7Hx86QHjYtHoRx+2OqvCyh3lCPyhHU61SZkIELged8a955ewvw/37GgmrvpW3vL0YM6FYAZwyXO/bvvH7sIENyfLvH5brwv9WfU6qCWbIy15pqr7RCkICT3jc42OeGYFSJfjkuwGz2RaUug+bVc+K+ibXEAbfEzyt0CE9BzVw+xS3RY91XvO5XCSSXpA2yPhRlDF3JzjAbw87fUeypZ+QWXoesMpI+9rNwfyfXuPFFIVQmWng="
  - secure: "FB3w42JdNv+6dlnClSpOQYwxNGwc7mwWHr/JM1UH8LkOf+WyikO9lv2OFOGZmlUO+Ef6xVCkpO3+uamuxOfgyNe+FePEIW4AdeLG10SVDpYF9r5SChi5F0X3H4dfYIRe6Yq0yzHwTN8BsCNT+yRzqj4xK/ApZ1Fjwd+s64INmwAYvMcqvwj/t7mKVwJXHghQ6SglGteGQtTGQ4X/SGXfKM80cZMwskULkWIcWaRay7RW6z3f3DRL0jd83i0vtuAoDBtKu4gb7BJXOmaycUf6ttGaa4JP3fwR8P4+s+LbybL1Hq87YTN+NVnb+jR4c6reAhCkxHhQUKpHImCLGRW8Qv04Yze8FlHmvouAGcL8KqOMYol84tkiYX7IHjFIRg+P7nQQBsDPN9WsXXraVKoy7kaUBPuTWWnjP4C3M5GfzUBxmW+muR4tGzIdxeFCkgWNcsEpBNoQp2EnjPBd0qdPDhs0GuIytwwIL3evDYM8cup3jhBduKYD1NQ6qk0qqLVCAZo3uu7Sm4Y5dao1ud5w2BDfGroFiYrOhVUVGlvLd3gaeInXCoJ1+gArwfh+1YKEZtwJmj+dKFJt2h9OWAPR+ONbv2DRpKOQ+pzqjhUQicY8ZgZnXPp9hqTP2epLlXKjLVSEN882yQQmfSbIvjIQiA/py9bvaQ3FxKDeVK+sDX4="

  - secure: "ZB2Z9fDturnqMIIKQIe/4gX5IHgpSLF/Gmx3TbbutYG96znxmeaMZKngsFrOeWIzvpvNXB5sWqX8Mekr82/GBgAScfNWkhqWKO9HKbUgr1GwOBJKLr2gdjjWS8XeP1+qt00enDfhv9Xi339DgYSZMzSGGaALsJ2YuTvCm2ak9QBUMJZPJLkF4SkzXYBrKY0vJcuoHvqYIORo6q8pnUaJAnKwb7CUdGy/Dje7DKqh30Agu4rHdyy9DEGsqosuoU1XqTDpegA0m4dRxsaKZuTpYyFqqUf9+/K251O6oupTmVGQ/MnLbF8Z8OOJYX9HO9ZMJFLSGJoIl/FXo9zw4+lVGS3MOZYsU0Ce0b5KsRJdzmVVIbU6MoAUt/rOKOYynOuSA6HNT3yjP2vbV9umpc7lPySp9P7bY2zMCebNcaMSSVIMkFpl5OVcz9FaQeO4QJlxWU9QmGSO0vil67fc6ZArAzodHHk4L8TzrJMh9FD+TnGezQ4KDX0bD5dYmnqbzJYzhpxZtsc7l+tP4cDgbpSkydsWChWl3hmtp+osGD7fCe2QaL859vwRCbAUjvNBqs8gb2YNtpfW77e1KPKPn7j8MvX8lUPGBy7lUlM1QcMhhUoX0ZpO2MQ9B3v0roTzj9Cs5cFkJP4DGrB8ItFilUydPfh0e59NU/QTtkw4bk5dqS8="

deploy:
  provider: heroku
  api_key:
    secure: "KtZdPa3iJAFRsq/max6vaApVlZ13q6lCVjfEBES+Prrv+yV0K+bFoXaGk1C+QozyJT9RWsybyYRUb4XV6TsHi7avViM3T8upPN2wNwpLvxMsAWsQIRxjleseD7H3ltsb+mrrrclUaSQm6VkAnIUui0W/kRGEohjYowe0BNTTCvYxJ4bZ0+Cfnvln05pZKSmgkgxXDj8haiqhZRIXV9WAVd8l8UolYl8MKYoDyIj8Actgc1MYfG8QXjcDrBe9JTRX9vhqT5l7XwaPGt3LiO+L4rXpjugwRtCohUz7sx1HGKnmauOYj5Ywwz6fQFrmJoPyztncD6UayOeF2l9ETBkHdYYWYvp8gy6drhaXGRnvhlcspRTPvSs23GXl5MzI33u3NIbbuxBfvaT9RUvMlVCsoI36/9GNaAMGhnedPL9mVsOoWtexZIcOUorGsAjJ636qfDuTPe7Md+GfLYX8XKMZMQdzEm2tA/vlhdxjotPDPt9NLWn4EQmDM/5MhB4jnEJUIwD6iDMlxi8DrHCGmIP8m4mTePr+vFo2OXnS+jRmriJC5LOI7M5AZhW420tAN/+edx4z9ABUkrJ2X1fSk6+mTrYyyBougeiY4PF3Z2cFR0dQvatxsIjJmcmOiEgQIImxjN332vmpTbBbo0Alub/xkf0HrpnNCjVipMKhNt0xJlc="
  app: photoapp-api
  on: master